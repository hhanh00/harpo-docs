[{"uri":"https://harpocoin.xyz/chainsync/stages/","title":"Stages","tags":[],"description":"","content":"ChainSync: CS\nPurpose of ChainSync CS  Download and process blocks from peers Synchronize the blockchain Update chain state  Stages  CS starts when node boots and stops when the node stops CS is normally is mode CS_FOLLOW CS starts in CS_INIT If the chain is too far behind the current tip, CS switches to CS_SYNC  CS_INIT  Tip is set to last known best, or latest checkpoint or genesis block  CS_SYNC  Indicates that our node is too far behind and should quickly download and sync up Sync relies on a \u0026ldquo;torrent\u0026rdquo; like download mechanism Mode is entered when the median of the height of the peers is farther than 1 block from tip, for 30 seconds Mode is exited when at the end of the sync process, node is no longer in the above situation  CS_FOLLOW  Receives blocks through Gossip protocol and process them  "},{"uri":"https://harpocoin.xyz/chainsync/","title":"ChainSync","tags":[],"description":"","content":"Chapter 1 Chain Sync "},{"uri":"https://harpocoin.xyz/chainsync/sync/","title":"Sync Mode","tags":[],"description":"","content":"State  Peers  PeerId Listen address Hash, Height   Peer Leader: Peer that has the highest height, only peer we request headers from Headers  Headers are requested sequentially from Leader Response headers begin in DETACHED state    Chain Fragment Header State  List of headers received from GetHeaders DETACHED: headers have hash but no height, not validated and not connected to blockchain PARTIAL_LINKED: prev_hash links with hash of previous header. Headers form a list. No POW check, no timestamp check. Chain is not anchored yet. Trim headers that do not link and move them to INVALID state ANCHORED: First header links to a known tip. We can perform more validation  timestamp POW nonce Then trim the headers that fail validation Remaining headers =\u0026gt; Get Block using BlockSync   Send header fragment to block sync downloader  Header  INVALID: Header failed validation and is rejected  Block Sync  Download blocks from multiple peers  Block  Validate if block is right after current best tip  if block validates,  advance tip, update best tip if needed look for next block and repeat   if block does not validate,  mark remaining blocks/headers as INVALID evict Leader end CHAIN_SYNC retry CHAIN_SYNC with next best peer     If no more header fragments, end SYNC  Peer API  GetLastHeight -\u0026gt; height, hash GetHeaders(start_height, start_hash, num_headers) -\u0026gt; [BlockHeader] Return up to num_headers from given (start_height, start_hash) Error if start header is not known GetBlock(hash) -\u0026gt; Block  "},{"uri":"https://harpocoin.xyz/chainsync/block_sync/","title":"Block Sync","tags":[],"description":"","content":"Notes  Follow bittorrent principles a block = a piece we only download from peers we don\u0026rsquo;t choke peers  TODO: Study the BitTorrent protocol\nBlock Validation  Check merkle root Check transaction  zk proofs nullifiers auth signature    "},{"uri":"https://harpocoin.xyz/","title":"Harpo","tags":[],"description":"","content":""},{"uri":"https://harpocoin.xyz/categories/","title":"Categories","tags":[],"description":"","content":""},{"uri":"https://harpocoin.xyz/tags/","title":"Tags","tags":[],"description":"","content":""}]